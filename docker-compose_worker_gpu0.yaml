x-profile-config: &profile_config_volume
  type: bind
  source: ${ROOT_PATH}/config/profiles.yaml
  target: /app/config/profiles.yaml
  read_only: true

services:
  #+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++#
  #-------------------------------------------------------------------------------------------------------------#
  # Pipeline Worker Services (scalable)
  pipeline-worker-0:
    image: fr-server-pipeline_worker_service:latest
    container_name: fr_pipeline_worker_gpu0_0
    runtime: nvidia
    environment:
      - NAMESPACE=${SERVER_NAME}
      - NVIDIA_VISIBLE_DEVICES=0
      - SERVICE_TYPE=pipeline-worker
      - PIPELINE_ID=0
      - RMQ_URL=amqp://admin:admin123@rmq_Server:5672
      - CONFIG_PROFILE=${CONFIG_PROFILE:-prod-1gpu-24gb}
      - CONFIG_PATH=/app/config/profiles.yaml
      - STORAGE_ENDPOINT=${STORAGE_ENDPOINT:-minio:9000}
      - STORAGE_ACCESS_KEY=${STORAGE_ACCESS_KEY:-minioadmin}
      - STORAGE_SECRET_KEY=${STORAGE_SECRET_KEY:-minioadmin}
      - STORAGE_SECURE=${STORAGE_SECURE:-false}
      - STORAGE_FRAMES_BUCKET=${STORAGE_FRAMES_BUCKET:-face-frames}
    volumes:
      - type: bind
        source: ${DATA_DIR}/logs/${SERVER_NAME}
        target: /app/${SERVER_NAME}/logs
      - type: bind
        source: ${ROOT_PATH}/Models_Weights
        target: /app/Models_Weights
      - type: bind
        source: ${DATA_DIR}
        target: /app/Data
      - *profile_config_volume
    networks:
      - rmq_network
      - storage_network
    restart: unless-stopped
  # healthcheck:
  #   test: [ "CMD", "nc", "-z", "rmq_Server", "5672" ]
  #   interval: 30s
  #   timeout: 10s
  #   retries: 5
  #   start_period: 40s
  #+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++#
  #-------------------------------------------------------------------------------------------------------------#
  pipeline-worker-1:
    image: fr-server-pipeline_worker_service:latest
    container_name: fr_pipeline_worker_gpu0_1
    runtime: nvidia
    environment:
      - NAMESPACE=${SERVER_NAME}
      - NVIDIA_VISIBLE_DEVICES=0
      - SERVICE_TYPE=pipeline-worker
      - PIPELINE_ID=1
      - RMQ_URL=amqp://admin:admin123@rmq_Server:5672
      - CONFIG_PROFILE=${CONFIG_PROFILE:-prod-1gpu-24gb}
      - CONFIG_PATH=/app/config/profiles.yaml
      - STORAGE_ENDPOINT=${STORAGE_ENDPOINT:-minio:9000}
      - STORAGE_ACCESS_KEY=${STORAGE_ACCESS_KEY:-minioadmin}
      - STORAGE_SECRET_KEY=${STORAGE_SECRET_KEY:-minioadmin}
      - STORAGE_SECURE=${STORAGE_SECURE:-false}
      - STORAGE_FRAMES_BUCKET=${STORAGE_FRAMES_BUCKET:-face-frames}
    volumes:
      - type: bind
        source: ${DATA_DIR}/logs/${SERVER_NAME}
        target: /app/${SERVER_NAME}/logs
      - type: bind
        source: ${ROOT_PATH}/Models_Weights
        target: /app/Models_Weights
      - type: bind
        source: ${DATA_DIR}
        target: /app/Data
      - *profile_config_volume
    networks:
      - rmq_network
      - storage_network
    restart: unless-stopped
  # healthcheck:
  #   test: [ "CMD", "nc", "-z", "rmq_Server", "5672" ]
  #   interval: 30s
  #   timeout: 10s
  #   retries: 5
  #   start_period: 40s
  # +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++#
  # -------------------------------------------------------------------------------------------------------------#
  pipeline-worker-2:
    image: fr-server-pipeline_worker_service:latest
    container_name: fr_pipeline_worker_gpu0_2
    runtime: nvidia
    environment:
      - NAMESPACE=${SERVER_NAME}
      - NVIDIA_VISIBLE_DEVICES=0
      - SERVICE_TYPE=pipeline-worker
      - PIPELINE_ID=2
      - MaxClientPerPipeline=30
      - RMQ_URL=amqp://admin:admin123@rmq_Server:5672
      - CONFIG_PROFILE=${CONFIG_PROFILE:-prod-1gpu-24gb}
      - CONFIG_PATH=/app/config/profiles.yaml
      - STORAGE_ENDPOINT=${STORAGE_ENDPOINT:-minio:9000}
      - STORAGE_ACCESS_KEY=${STORAGE_ACCESS_KEY:-minioadmin}
      - STORAGE_SECRET_KEY=${STORAGE_SECRET_KEY:-minioadmin}
      - STORAGE_SECURE=${STORAGE_SECURE:-false}
      - STORAGE_FRAMES_BUCKET=${STORAGE_FRAMES_BUCKET:-face-frames}
    volumes:
      - type: bind
        source: ${DATA_DIR}/logs/${SERVER_NAME}
        target: /app/${SERVER_NAME}/logs
      - type: bind
        source: ${ROOT_PATH}/Models_Weights
        target: /app/Models_Weights
      - type: bind
        source: ${DATA_DIR}
        target: /app/Data
      - *profile_config_volume
    networks:
      - rmq_network
      - storage_network
    restart: unless-stopped
  # healthcheck:
  #   test: [ "CMD", "nc", "-z", "rmq_Server", "5672" ]
  #   interval: 30s
  #   timeout: 10s
  #   retries: 5
  #   start_period: 40s
  #+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++#
  #-------------------------------------------------------------------------------------------------------------#
  pipeline-worker-3:
    image: fr-server-pipeline_worker_service:latest
    container_name: fr_pipeline_worker_gpu0_3
    runtime: nvidia
    environment:
      - NAMESPACE=${SERVER_NAME}
      - NVIDIA_VISIBLE_DEVICES=0
      - SERVICE_TYPE=pipeline-worker
      - PIPELINE_ID=3
      - MaxClientPerPipeline=30
      - RMQ_URL=amqp://admin:admin123@rmq_Server:5672
      - CONFIG_PROFILE=${CONFIG_PROFILE:-prod-1gpu-24gb}
      - CONFIG_PATH=/app/config/profiles.yaml
      - STORAGE_ENDPOINT=${STORAGE_ENDPOINT:-minio:9000}
      - STORAGE_ACCESS_KEY=${STORAGE_ACCESS_KEY:-minioadmin}
      - STORAGE_SECRET_KEY=${STORAGE_SECRET_KEY:-minioadmin}
      - STORAGE_SECURE=${STORAGE_SECURE:-false}
      - STORAGE_FRAMES_BUCKET=${STORAGE_FRAMES_BUCKET:-face-frames}
    volumes:
      - type: bind
        source: ${DATA_DIR}/logs/${SERVER_NAME}
        target: /app/${SERVER_NAME}/logs
      - type: bind
        source: ${ROOT_PATH}/Models_Weights
        target: /app/Models_Weights
      - type: bind
        source: ${DATA_DIR}
        target: /app/Data
      - *profile_config_volume
    networks:
      - rmq_network
      - storage_network
    restart: unless-stopped
      
  pipeline-worker-4:
    image: fr-server-pipeline_worker_service:latest
    container_name: fr_pipeline_worker_gpu0_4
    runtime: nvidia
    environment:
      - NAMESPACE=${SERVER_NAME}
      - NVIDIA_VISIBLE_DEVICES=0  
      - SERVICE_TYPE=pipeline-worker
      - PIPELINE_ID=4
      - MaxClientPerPipeline=30
      - RMQ_URL=amqp://admin:admin123@rmq_Server:5672
      - CONFIG_PROFILE=${CONFIG_PROFILE:-prod-1gpu-24gb}
      - CONFIG_PATH=/app/config/profiles.yaml
      - STORAGE_ENDPOINT=${STORAGE_ENDPOINT:-minio:9000}
      - STORAGE_ACCESS_KEY=${STORAGE_ACCESS_KEY:-minioadmin}
      - STORAGE_SECRET_KEY=${STORAGE_SECRET_KEY:-minioadmin}
      - STORAGE_SECURE=${STORAGE_SECURE:-false}
      - STORAGE_FRAMES_BUCKET=${STORAGE_FRAMES_BUCKET:-face-frames}
    volumes:
      - type: bind
        source: ${DATA_DIR}/logs/${SERVER_NAME}
        target: /app/${SERVER_NAME}/logs
      - type: bind
        source: ${ROOT_PATH}/Models_Weights
        target: /app/Models_Weights
      - type: bind
        source: ${DATA_DIR}
        target: /app/Data
      - *profile_config_volume
    networks:
      - rmq_network
      - storage_network
    restart: unless-stopped
  pipeline-worker-5:
    image: fr-server-pipeline_worker_service:latest
    container_name: fr_pipeline_worker_gpu0_5
    runtime: nvidia
    environment:
      - NAMESPACE=${SERVER_NAME}
      - NVIDIA_VISIBLE_DEVICES=0  
      - SERVICE_TYPE=pipeline-worker
      - PIPELINE_ID=5
      - MaxClientPerPipeline=30
      - RMQ_URL=amqp://admin:admin123@rmq_Server:5672
      - CONFIG_PROFILE=${CONFIG_PROFILE:-prod-1gpu-24gb}
      - CONFIG_PATH=/app/config/profiles.yaml
      - STORAGE_ENDPOINT=${STORAGE_ENDPOINT:-minio:9000}
      - STORAGE_ACCESS_KEY=${STORAGE_ACCESS_KEY:-minioadmin}
      - STORAGE_SECRET_KEY=${STORAGE_SECRET_KEY:-minioadmin}
      - STORAGE_SECURE=${STORAGE_SECURE:-false}
      - STORAGE_FRAMES_BUCKET=${STORAGE_FRAMES_BUCKET:-face-frames}
    volumes:
      - type: bind
        source: ${DATA_DIR}/logs/${SERVER_NAME}
        target: /app/${SERVER_NAME}/logs
      - type: bind
        source: ${ROOT_PATH}/Models_Weights
        target: /app/Models_Weights
      - type: bind
        source: ${DATA_DIR}
        target: /app/Data
      - *profile_config_volume
    networks:
      - rmq_network
      - storage_network
    restart: unless-stopped
    

  pipeline-worker-6:
    image: fr-server-pipeline_worker_service:latest
    container_name: fr_pipeline_worker_gpu0_6
    runtime: nvidia
    environment:
      - NAMESPACE=${SERVER_NAME}
      - NVIDIA_VISIBLE_DEVICES=0  
      - SERVICE_TYPE=pipeline-worker
      - PIPELINE_ID=6
      - MaxClientPerPipeline=30
      - RMQ_URL=amqp://admin:admin123@rmq_Server:5672
      - CONFIG_PROFILE=${CONFIG_PROFILE:-prod-1gpu-24gb}
      - CONFIG_PATH=/app/config/profiles.yaml
      - STORAGE_ENDPOINT=${STORAGE_ENDPOINT:-minio:9000}
      - STORAGE_ACCESS_KEY=${STORAGE_ACCESS_KEY:-minioadmin}
      - STORAGE_SECRET_KEY=${STORAGE_SECRET_KEY:-minioadmin}
      - STORAGE_SECURE=${STORAGE_SECURE:-false}
      - STORAGE_FRAMES_BUCKET=${STORAGE_FRAMES_BUCKET:-face-frames}
    volumes:
      - type: bind
        source: ${DATA_DIR}/logs/${SERVER_NAME}
        target: /app/${SERVER_NAME}/logs
      - type: bind
        source: ${ROOT_PATH}/Models_Weights
        target: /app/Models_Weights
      - type: bind
        source: ${DATA_DIR}
        target: /app/Data
      - *profile_config_volume
    networks:
      - rmq_network
      - storage_network
    restart: unless-stopped


  pipeline-worker-7:
    image: fr-server-pipeline_worker_service:latest
    container_name: fr_pipeline_worker_gpu0_7
    runtime: nvidia
    environment:
      - NAMESPACE=${SERVER_NAME}
      - NVIDIA_VISIBLE_DEVICES=0  
      - SERVICE_TYPE=pipeline-worker
      - PIPELINE_ID=7
      - MaxClientPerPipeline=30
      - RMQ_URL=amqp://admin:admin123@rmq_Server:5672
      - CONFIG_PROFILE=${CONFIG_PROFILE:-prod-1gpu-24gb}
      - CONFIG_PATH=/app/config/profiles.yaml
      - STORAGE_ENDPOINT=${STORAGE_ENDPOINT:-minio:9000}
      - STORAGE_ACCESS_KEY=${STORAGE_ACCESS_KEY:-minioadmin}
      - STORAGE_SECRET_KEY=${STORAGE_SECRET_KEY:-minioadmin}
      - STORAGE_SECURE=${STORAGE_SECURE:-false}
      - STORAGE_FRAMES_BUCKET=${STORAGE_FRAMES_BUCKET:-face-frames}
    volumes:
      - type: bind
        source: ${DATA_DIR}/logs/${SERVER_NAME}
        target: /app/${SERVER_NAME}/logs
      - type: bind
        source: ${ROOT_PATH}/Models_Weights
        target: /app/Models_Weights
      - type: bind
        source: ${DATA_DIR}
        target: /app/Data
      - *profile_config_volume
    networks:
      - rmq_network
      - storage_network
    restart: unless-stopped    

  pipeline-worker-8:
    image: fr-server-pipeline_worker_service:latest
    container_name: fr_pipeline_worker_gpu0_8
    runtime: nvidia
    environment:
      - NAMESPACE=${SERVER_NAME}
      - NVIDIA_VISIBLE_DEVICES=0  
      - SERVICE_TYPE=pipeline-worker
      - PIPELINE_ID=8
      - MaxClientPerPipeline=30
      - RMQ_URL=amqp://admin:admin123@rmq_Server:5672
      - CONFIG_PROFILE=${CONFIG_PROFILE:-prod-1gpu-24gb}
      - CONFIG_PATH=/app/config/profiles.yaml
      - STORAGE_ENDPOINT=${STORAGE_ENDPOINT:-minio:9000}
      - STORAGE_ACCESS_KEY=${STORAGE_ACCESS_KEY:-minioadmin}
      - STORAGE_SECRET_KEY=${STORAGE_SECRET_KEY:-minioadmin}
      - STORAGE_SECURE=${STORAGE_SECURE:-false}
      - STORAGE_FRAMES_BUCKET=${STORAGE_FRAMES_BUCKET:-face-frames}
    volumes:
      - type: bind
        source: ${DATA_DIR}/logs/${SERVER_NAME}
        target: /app/${SERVER_NAME}/logs
      - type: bind
        source: ${ROOT_PATH}/Models_Weights
        target: /app/Models_Weights
      - type: bind
        source: ${DATA_DIR}
        target: /app/Data
      - *profile_config_volume
    networks:
      - rmq_network
      - storage_network
    restart: unless-stopped
  
  pipeline-worker-9:
    image: fr-server-pipeline_worker_service:latest
    container_name: fr_pipeline_worker_gpu0_9
    runtime: nvidia
    environment:
      - NAMESPACE=${SERVER_NAME}
      - NVIDIA_VISIBLE_DEVICES=0  
      - SERVICE_TYPE=pipeline-worker
      - PIPELINE_ID=9
      - MaxClientPerPipeline=30
      - RMQ_URL=amqp://admin:admin123@rmq_Server:5672
      - CONFIG_PROFILE=${CONFIG_PROFILE:-prod-1gpu-24gb}
      - CONFIG_PATH=/app/config/profiles.yaml
      - STORAGE_ENDPOINT=${STORAGE_ENDPOINT:-minio:9000}
      - STORAGE_ACCESS_KEY=${STORAGE_ACCESS_KEY:-minioadmin}
      - STORAGE_SECRET_KEY=${STORAGE_SECRET_KEY:-minioadmin}
      - STORAGE_SECURE=${STORAGE_SECURE:-false}
      - STORAGE_FRAMES_BUCKET=${STORAGE_FRAMES_BUCKET:-face-frames}
    volumes:
      - type: bind
        source: ${DATA_DIR}/logs/${SERVER_NAME}
        target: /app/${SERVER_NAME}/logs
      - type: bind
        source: ${ROOT_PATH}/Models_Weights
        target: /app/Models_Weights
      - type: bind
        source: ${DATA_DIR}
        target: /app/Data
      - *profile_config_volume
    networks:
      - rmq_network
      - storage_network
    restart: unless-stopped


  pipeline-worker-10:
    image: fr-server-pipeline_worker_service:latest
    container_name: fr_pipeline_worker_gpu0_10
    runtime: nvidia
    environment:
      - NAMESPACE=${SERVER_NAME}
      - NVIDIA_VISIBLE_DEVICES=0  
      - SERVICE_TYPE=pipeline-worker
      - PIPELINE_ID=10
      - MaxClientPerPipeline=30
      - RMQ_URL=amqp://admin:admin123@rmq_Server:5672
      - CONFIG_PROFILE=${CONFIG_PROFILE:-prod-1gpu-24gb}
      - CONFIG_PATH=/app/config/profiles.yaml
      - STORAGE_ENDPOINT=${STORAGE_ENDPOINT:-minio:9000}
      - STORAGE_ACCESS_KEY=${STORAGE_ACCESS_KEY:-minioadmin}
      - STORAGE_SECRET_KEY=${STORAGE_SECRET_KEY:-minioadmin}
      - STORAGE_SECURE=${STORAGE_SECURE:-false}
      - STORAGE_FRAMES_BUCKET=${STORAGE_FRAMES_BUCKET:-face-frames}
    volumes:
      - type: bind
        source: ${DATA_DIR}/logs/${SERVER_NAME}
        target: /app/${SERVER_NAME}/logs
      - type: bind
        source: ${ROOT_PATH}/Models_Weights
        target: /app/Models_Weights
      - type: bind
        source: ${DATA_DIR}
        target: /app/Data
      - *profile_config_volume
    networks:
      - rmq_network
      - storage_network
    restart: unless-stopped

  pipeline-worker-11:
    image: fr-server-pipeline_worker_service:latest
    container_name: fr_pipeline_worker_gpu0_11
    runtime: nvidia
    environment:
      - NAMESPACE=${SERVER_NAME}
      - NVIDIA_VISIBLE_DEVICES=0  
      - SERVICE_TYPE=pipeline-worker
      - PIPELINE_ID=11
      - MaxClientPerPipeline=30
      - RMQ_URL=amqp://admin:admin123@rmq_Server:5672
      - CONFIG_PROFILE=${CONFIG_PROFILE:-prod-1gpu-24gb}
      - CONFIG_PATH=/app/config/profiles.yaml
      - STORAGE_ENDPOINT=${STORAGE_ENDPOINT:-minio:9000}
      - STORAGE_ACCESS_KEY=${STORAGE_ACCESS_KEY:-minioadmin}
      - STORAGE_SECRET_KEY=${STORAGE_SECRET_KEY:-minioadmin}
      - STORAGE_SECURE=${STORAGE_SECURE:-false}
      - STORAGE_FRAMES_BUCKET=${STORAGE_FRAMES_BUCKET:-face-frames}
    volumes:
      - type: bind
        source: ${DATA_DIR}/logs/${SERVER_NAME}
        target: /app/${SERVER_NAME}/logs
      - type: bind
        source: ${ROOT_PATH}/Models_Weights
        target: /app/Models_Weights
      - type: bind
        source: ${DATA_DIR}
        target: /app/Data
      - *profile_config_volume
    networks:
      - rmq_network
      - storage_network
    restart: unless-stopped

  pipeline-worker-12:
    image: fr-server-pipeline_worker_service:latest
    container_name: fr_pipeline_worker_gpu0_12
    runtime: nvidia
    environment:
      - NAMESPACE=${SERVER_NAME}
      - NVIDIA_VISIBLE_DEVICES=0  
      - SERVICE_TYPE=pipeline-worker
      - PIPELINE_ID=12
      - MaxClientPerPipeline=30
      - RMQ_URL=amqp://admin:admin123@rmq_Server:5672
      - CONFIG_PROFILE=${CONFIG_PROFILE:-prod-1gpu-24gb}
      - CONFIG_PATH=/app/config/profiles.yaml
      - STORAGE_ENDPOINT=${STORAGE_ENDPOINT:-minio:9000}
      - STORAGE_ACCESS_KEY=${STORAGE_ACCESS_KEY:-minioadmin}
      - STORAGE_SECRET_KEY=${STORAGE_SECRET_KEY:-minioadmin}
      - STORAGE_SECURE=${STORAGE_SECURE:-false}
      - STORAGE_FRAMES_BUCKET=${STORAGE_FRAMES_BUCKET:-face-frames}
    volumes:
      - type: bind
        source: ${DATA_DIR}/logs/${SERVER_NAME}
        target: /app/${SERVER_NAME}/logs
      - type: bind
        source: ${ROOT_PATH}/Models_Weights
        target: /app/Models_Weights
      - type: bind
        source: ${DATA_DIR}
        target: /app/Data
      - *profile_config_volume
    networks:
      - rmq_network
      - storage_network
    restart: unless-stopped

  pipeline-worker-13:
    image: fr-server-pipeline_worker_service:latest
    container_name: fr_pipeline_worker_gpu0_13
    runtime: nvidia
    environment:
      - NAMESPACE=${SERVER_NAME}
      - NVIDIA_VISIBLE_DEVICES=0  
      - SERVICE_TYPE=pipeline-worker
      - PIPELINE_ID=13
      - MaxClientPerPipeline=30
      - RMQ_URL=amqp://admin:admin123@rmq_Server:5672
      - CONFIG_PROFILE=${CONFIG_PROFILE:-prod-1gpu-24gb}
      - CONFIG_PATH=/app/config/profiles.yaml
      - STORAGE_ENDPOINT=${STORAGE_ENDPOINT:-minio:9000}
      - STORAGE_ACCESS_KEY=${STORAGE_ACCESS_KEY:-minioadmin}
      - STORAGE_SECRET_KEY=${STORAGE_SECRET_KEY:-minioadmin}
      - STORAGE_SECURE=${STORAGE_SECURE:-false}
      - STORAGE_FRAMES_BUCKET=${STORAGE_FRAMES_BUCKET:-face-frames}
    volumes:
      - type: bind
        source: ${DATA_DIR}/logs/${SERVER_NAME}
        target: /app/${SERVER_NAME}/logs
      - type: bind
        source: ${ROOT_PATH}/Models_Weights
        target: /app/Models_Weights
      - type: bind
        source: ${DATA_DIR}
        target: /app/Data
      - *profile_config_volume
    networks:
      - rmq_network
      - storage_network
    restart: unless-stopped



  pipeline-worker-14:
    image: fr-server-pipeline_worker_service:latest
    container_name: fr_pipeline_worker_gpu0_14
    runtime: nvidia
    environment:
      - NAMESPACE=${SERVER_NAME}
      - NVIDIA_VISIBLE_DEVICES=0  
      - SERVICE_TYPE=pipeline-worker
      - PIPELINE_ID=14
      - MaxClientPerPipeline=30
      - RMQ_URL=amqp://admin:admin123@rmq_Server:5672
      - CONFIG_PROFILE=${CONFIG_PROFILE:-prod-1gpu-24gb}
      - CONFIG_PATH=/app/config/profiles.yaml
      - STORAGE_ENDPOINT=${STORAGE_ENDPOINT:-minio:9000}
      - STORAGE_ACCESS_KEY=${STORAGE_ACCESS_KEY:-minioadmin}
      - STORAGE_SECRET_KEY=${STORAGE_SECRET_KEY:-minioadmin}
      - STORAGE_SECURE=${STORAGE_SECURE:-false}
      - STORAGE_FRAMES_BUCKET=${STORAGE_FRAMES_BUCKET:-face-frames}
    volumes:
      - type: bind
        source: ${DATA_DIR}/logs/${SERVER_NAME}
        target: /app/${SERVER_NAME}/logs
      - type: bind
        source: ${ROOT_PATH}/Models_Weights
        target: /app/Models_Weights
      - type: bind
        source: ${DATA_DIR}
        target: /app/Data
      - *profile_config_volume
    networks:
      - rmq_network
      - storage_network
    restart: unless-stopped

  pipeline-worker-15:
    image: fr-server-pipeline_worker_service:latest
    container_name: fr_pipeline_worker_gpu0_15
    runtime: nvidia
    environment:
      - NAMESPACE=${SERVER_NAME}
      - NVIDIA_VISIBLE_DEVICES=0  
      - SERVICE_TYPE=pipeline-worker
      - PIPELINE_ID=15
      - MaxClientPerPipeline=30
      - RMQ_URL=amqp://admin:admin123@rmq_Server:5672
      - CONFIG_PROFILE=${CONFIG_PROFILE:-prod-1gpu-24gb}
      - CONFIG_PATH=/app/config/profiles.yaml
      - STORAGE_ENDPOINT=${STORAGE_ENDPOINT:-minio:9000}
      - STORAGE_ACCESS_KEY=${STORAGE_ACCESS_KEY:-minioadmin}
      - STORAGE_SECRET_KEY=${STORAGE_SECRET_KEY:-minioadmin}
      - STORAGE_SECURE=${STORAGE_SECURE:-false}
      - STORAGE_FRAMES_BUCKET=${STORAGE_FRAMES_BUCKET:-face-frames}
    volumes:
      - type: bind
        source: ${DATA_DIR}/logs/${SERVER_NAME}
        target: /app/${SERVER_NAME}/logs
      - type: bind
        source: ${ROOT_PATH}/Models_Weights
        target: /app/Models_Weights
      - type: bind
        source: ${DATA_DIR}
        target: /app/Data
      - *profile_config_volume
    networks:
      - rmq_network
      - storage_network
    restart: unless-stopped

# healthcheck:
#   test: [ "CMD", "nc", "-z", "rmq_Server", "5672" ]
#   interval: 30s
#   timeout: 10s
#   retries: 5
#   start_period: 40s
# +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++#
#-------------------------------------------------------------------------------------------------------------#
#**************************************************************************************************************#
#**************************************************************************************************************#
networks:
  rmq_network:
    external: True
  storage_network:
    external: True
